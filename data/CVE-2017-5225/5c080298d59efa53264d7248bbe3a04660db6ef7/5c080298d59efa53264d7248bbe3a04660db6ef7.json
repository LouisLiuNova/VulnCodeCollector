{
    "owner": "vadz",
    "repo": "libtiff",
    "commit_sha": "5c080298d59efa53264d7248bbe3a04660db6ef7",
    "commit_massage": "* tools/tiffcp.c: error out cleanly in cpContig2SeparateByRow and\ncpSeparate2ContigByRow if BitsPerSample != 8 to avoid heap based overflow.\nFixes http://bugzilla.maptools.org/show_bug.cgi?id=2656 and\nhttp://bugzilla.maptools.org/show_bug.cgi?id=2657",
    "raw_ref": "https://api.github.com/repos/vadz/libtiff/commits/5c080298d59efa53264d7248bbe3a04660db6ef7",
    "html_ref": "https://github.com/vadz/libtiff/commit/5c080298d59efa53264d7248bbe3a04660db6ef7",
    "author": "erouault",
    "changes_stats": {
        "total": 31,
        "additions": 29,
        "deletions": 2
    },
    "files": [
        {
            "sha": "064f25b661ad7651131615a5c2049fa08854dae0",
            "filename": "ChangeLog",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vadz/libtiff/blob/5c080298d59efa53264d7248bbe3a04660db6ef7/ChangeLog",
            "raw_url": "https://github.com/vadz/libtiff/raw/5c080298d59efa53264d7248bbe3a04660db6ef7/ChangeLog",
            "contents_url": "https://api.github.com/repos/vadz/libtiff/contents/ChangeLog?ref=5c080298d59efa53264d7248bbe3a04660db6ef7",
            "patch": "@@ -1,3 +1,10 @@\n+2017-01-11 Even Rouault <even.rouault at spatialys.com>\n+\n+\t* tools/tiffcp.c: error out cleanly in cpContig2SeparateByRow and\n+\tcpSeparate2ContigByRow if BitsPerSample != 8 to avoid heap based overflow.\n+\tFixes http://bugzilla.maptools.org/show_bug.cgi?id=2656 and\n+\thttp://bugzilla.maptools.org/show_bug.cgi?id=2657\n+\n 2017-01-11 Even Rouault <even.rouault at spatialys.com>\n \n \t* libtiff/tiffio.h, tif_unix.c, tif_win32.c, tif_vms.c: add _TIFFcalloc()"
        },
        {
            "sha": "8bbcd52fcb0084c0a8d1d8ee6ea73a396a7d14ec",
            "filename": "tools/tiffcp.c",
            "status": "modified",
            "additions": 22,
            "deletions": 2,
            "changes": 24,
            "blob_url": "https://github.com/vadz/libtiff/blob/5c080298d59efa53264d7248bbe3a04660db6ef7/tools%2Ftiffcp.c",
            "raw_url": "https://github.com/vadz/libtiff/raw/5c080298d59efa53264d7248bbe3a04660db6ef7/tools%2Ftiffcp.c",
            "contents_url": "https://api.github.com/repos/vadz/libtiff/contents/tools%2Ftiffcp.c?ref=5c080298d59efa53264d7248bbe3a04660db6ef7",
            "patch": "@@ -591,7 +591,7 @@ static\tcopyFunc pickCopyFunc(TIFF*, TIFF*, uint16, uint16);\n static int\n tiffcp(TIFF* in, TIFF* out)\n {\n-\tuint16 bitspersample, samplesperpixel = 1;\n+\tuint16 bitspersample = 1, samplesperpixel = 1;\n \tuint16 input_compression, input_photometric = PHOTOMETRIC_MINISBLACK;\n \tcopyFunc cf;\n \tuint32 width, length;\n@@ -1067,6 +1067,16 @@ DECLAREcpFunc(cpContig2SeparateByRow)\n \tregister uint32 n;\n \tuint32 row;\n \ttsample_t s;\n+        uint16 bps = 0;\n+\n+        (void) TIFFGetField(in, TIFFTAG_BITSPERSAMPLE, &bps);\n+        if( bps != 8 )\n+        {\n+            TIFFError(TIFFFileName(in),\n+                      \"Error, can only handle BitsPerSample=8 in %s\",\n+                      \"cpContig2SeparateByRow\");\n+            return 0;\n+        }\n \n \tinbuf = _TIFFmalloc(scanlinesizein);\n \toutbuf = _TIFFmalloc(scanlinesizeout);\n@@ -1120,6 +1130,16 @@ DECLAREcpFunc(cpSeparate2ContigByRow)\n \tregister uint32 n;\n \tuint32 row;\n \ttsample_t s;\n+        uint16 bps = 0;\n+\n+        (void) TIFFGetField(in, TIFFTAG_BITSPERSAMPLE, &bps);\n+        if( bps != 8 )\n+        {\n+            TIFFError(TIFFFileName(in),\n+                      \"Error, can only handle BitsPerSample=8 in %s\",\n+                      \"cpSeparate2ContigByRow\");\n+            return 0;\n+        }\n \n \tinbuf = _TIFFmalloc(scanlinesizein);\n \toutbuf = _TIFFmalloc(scanlinesizeout);\n@@ -1784,7 +1804,7 @@ pickCopyFunc(TIFF* in, TIFF* out, uint16 bitspersample, uint16 samplesperpixel)\n \tuint32 w, l, tw, tl;\n \tint bychunk;\n \n-\t(void) TIFFGetField(in, TIFFTAG_PLANARCONFIG, &shortv);\n+\t(void) TIFFGetFieldDefaulted(in, TIFFTAG_PLANARCONFIG, &shortv);\n \tif (shortv != config && bitspersample != 8 && samplesperpixel > 1) {\n \t\tfprintf(stderr,\n \t\t    \"%s: Cannot handle different planar configuration w/ bits/sample != 8\\n\","
        }
    ],
    "parent_commit_sha": "393881da1a7fee683c0ec062a7d1ccdf3fa47385"
}