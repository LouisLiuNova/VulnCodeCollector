{
    "owner": "torvalds",
    "repo": "linux",
    "commit_sha": "fa7ea87a057958a8b7926c1a60a3ca6d696328ed",
    "commit_massage": "fs/partitions: Validate map_count in Mac partition tables\n\nValidate number of blocks in map and remove redundant variable.\n\nSigned-off-by: Timo Warns <warns@pre-sense.de>\nCc: stable@kernel.org\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
    "raw_ref": "https://api.github.com/repos/torvalds/linux/commits/fa7ea87a057958a8b7926c1a60a3ca6d696328ed",
    "html_ref": "https://github.com/torvalds/linux/commit/fa7ea87a057958a8b7926c1a60a3ca6d696328ed",
    "author": "Timo Warns",
    "changes_stats": {
        "total": 17,
        "additions": 9,
        "deletions": 8
    },
    "files": [
        {
            "sha": "11f688bd76c53c46f8b99b52ab56043bf9c38c99",
            "filename": "fs/partitions/mac.c",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/torvalds/linux/blob/fa7ea87a057958a8b7926c1a60a3ca6d696328ed/fs%2Fpartitions%2Fmac.c",
            "raw_url": "https://github.com/torvalds/linux/raw/fa7ea87a057958a8b7926c1a60a3ca6d696328ed/fs%2Fpartitions%2Fmac.c",
            "contents_url": "https://api.github.com/repos/torvalds/linux/contents/fs%2Fpartitions%2Fmac.c?ref=fa7ea87a057958a8b7926c1a60a3ca6d696328ed",
            "patch": "@@ -29,10 +29,9 @@ static inline void mac_fix_string(char *stg, int len)\n \n int mac_partition(struct parsed_partitions *state)\n {\n-\tint slot = 1;\n \tSector sect;\n \tunsigned char *data;\n-\tint blk, blocks_in_map;\n+\tint slot, blocks_in_map;\n \tunsigned secsize;\n #ifdef CONFIG_PPC_PMAC\n \tint found_root = 0;\n@@ -59,10 +58,14 @@ int mac_partition(struct parsed_partitions *state)\n \t\tput_dev_sector(sect);\n \t\treturn 0;\t\t/* not a MacOS disk */\n \t}\n-\tstrlcat(state->pp_buf, \" [mac]\", PAGE_SIZE);\n \tblocks_in_map = be32_to_cpu(part->map_count);\n-\tfor (blk = 1; blk <= blocks_in_map; ++blk) {\n-\t\tint pos = blk * secsize;\n+\tif (blocks_in_map < 0 || blocks_in_map >= DISK_MAX_PARTS) {\n+\t\tput_dev_sector(sect);\n+\t\treturn 0;\n+\t}\n+\tstrlcat(state->pp_buf, \" [mac]\", PAGE_SIZE);\n+\tfor (slot = 1; slot <= blocks_in_map; ++slot) {\n+\t\tint pos = slot * secsize;\n \t\tput_dev_sector(sect);\n \t\tdata = read_part_sector(state, pos/512, &sect);\n \t\tif (!data)\n@@ -113,13 +116,11 @@ int mac_partition(struct parsed_partitions *state)\n \t\t\t}\n \n \t\t\tif (goodness > found_root_goodness) {\n-\t\t\t\tfound_root = blk;\n+\t\t\t\tfound_root = slot;\n \t\t\t\tfound_root_goodness = goodness;\n \t\t\t}\n \t\t}\n #endif /* CONFIG_PPC_PMAC */\n-\n-\t\t++slot;\n \t}\n #ifdef CONFIG_PPC_PMAC\n \tif (found_root_goodness)"
        }
    ],
    "parent_commit_sha": "ee715087024b91a6ceb85ba2d02f6c35d354a48c"
}