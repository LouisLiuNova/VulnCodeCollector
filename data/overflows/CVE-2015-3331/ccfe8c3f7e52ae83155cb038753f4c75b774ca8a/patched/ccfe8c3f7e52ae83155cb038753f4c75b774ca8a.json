{
    "owner": "torvalds",
    "repo": "linux",
    "commit_sha": "ccfe8c3f7e52ae83155cb038753f4c75b774ca8a",
    "commit_massage": "crypto: aesni - fix memory usage in GCM decryption\n\nThe kernel crypto API logic requires the caller to provide the\nlength of (ciphertext || authentication tag) as cryptlen for the\nAEAD decryption operation. Thus, the cipher implementation must\ncalculate the size of the plaintext output itself and cannot simply use\ncryptlen.\n\nThe RFC4106 GCM decryption operation tries to overwrite cryptlen memory\nin req->dst. As the destination buffer for decryption only needs to hold\nthe plaintext memory but cryptlen references the input buffer holding\n(ciphertext || authentication tag), the assumption of the destination\nbuffer length in RFC4106 GCM operation leads to a too large size. This\npatch simply uses the already calculated plaintext size.\n\nIn addition, this patch fixes the offset calculation of the AAD buffer\npointer: as mentioned before, cryptlen already includes the size of the\ntag. Thus, the tag does not need to be added. With the addition, the AAD\nwill be written beyond the already allocated buffer.\n\nNote, this fixes a kernel crash that can be triggered from user space\nvia AF_ALG(aead) -- simply use the libkcapi test application\nfrom [1] and update it to use rfc4106-gcm-aes.\n\nUsing [1], the changes were tested using CAVS vectors to demonstrate\nthat the crypto operation still delivers the right results.\n\n[1] http://www.chronox.de/libkcapi.html\n\nCC: Tadeusz Struk <tadeusz.struk@intel.com>\nCc: stable@vger.kernel.org\nSigned-off-by: Stephan Mueller <smueller@chronox.de>\nSigned-off-by: Herbert Xu <herbert@gondor.apana.org.au>",
    "raw_ref": "https://api.github.com/repos/torvalds/linux/commits/ccfe8c3f7e52ae83155cb038753f4c75b774ca8a",
    "html_ref": "https://github.com/torvalds/linux/commit/ccfe8c3f7e52ae83155cb038753f4c75b774ca8a",
    "author": "smuellerDD",
    "changes_stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    },
    "files": [
        {
            "sha": "54f60ab41c63025fd2cb42e5579df7f69c3d9b60",
            "filename": "arch/x86/crypto/aesni-intel_glue.c",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/torvalds/linux/blob/ccfe8c3f7e52ae83155cb038753f4c75b774ca8a/arch%2Fx86%2Fcrypto%2Faesni-intel_glue.c",
            "raw_url": "https://github.com/torvalds/linux/raw/ccfe8c3f7e52ae83155cb038753f4c75b774ca8a/arch%2Fx86%2Fcrypto%2Faesni-intel_glue.c",
            "contents_url": "https://api.github.com/repos/torvalds/linux/contents/arch%2Fx86%2Fcrypto%2Faesni-intel_glue.c?ref=ccfe8c3f7e52ae83155cb038753f4c75b774ca8a",
            "patch": "@@ -1155,7 +1155,7 @@ static int __driver_rfc4106_decrypt(struct aead_request *req)\n \t\tsrc = kmalloc(req->cryptlen + req->assoclen, GFP_ATOMIC);\n \t\tif (!src)\n \t\t\treturn -ENOMEM;\n-\t\tassoc = (src + req->cryptlen + auth_tag_len);\n+\t\tassoc = (src + req->cryptlen);\n \t\tscatterwalk_map_and_copy(src, req->src, 0, req->cryptlen, 0);\n \t\tscatterwalk_map_and_copy(assoc, req->assoc, 0,\n \t\t\treq->assoclen, 0);\n@@ -1180,7 +1180,7 @@ static int __driver_rfc4106_decrypt(struct aead_request *req)\n \t\tscatterwalk_done(&src_sg_walk, 0, 0);\n \t\tscatterwalk_done(&assoc_sg_walk, 0, 0);\n \t} else {\n-\t\tscatterwalk_map_and_copy(dst, req->dst, 0, req->cryptlen, 1);\n+\t\tscatterwalk_map_and_copy(dst, req->dst, 0, tempCipherLen, 1);\n \t\tkfree(src);\n \t}\n \treturn retval;"
        }
    ],
    "parent_commit_sha": "001eabfd54c0cbf9d7d16264ddc8cc0bee67e3ed"
}